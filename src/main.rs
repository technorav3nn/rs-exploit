mod init;
mod memory_util;
mod rbx;
mod util;

use init::Initalize;
use std::{thread, time::Duration};

extern crate small_ctor;

#[small_ctor::ctor]
unsafe fn dylib_main() {
    thread::spawn(move || {
        thread::sleep(Duration::from_secs(15));

        Initalize::init();
    });
}

#[allow(dead_code)]
fn main() {
    println!("MAIN LOL");
}

//    let print_addy: i64 = 0x100bae55d;
/*
// temp 0x0 since idk the addys
let addy = (0x0 - 0x0 + handle as usize);
let roblox_print: RobloxPrint = unsafe { std::mem::transmute(addy) };

roblox_print(
    RobloxPrintType::Message,
    std::ffi::CString::new("hello little boy").unwrap().as_ptr(),
);
type RobloxPrint = extern "C" fn(i32, *const std::os::raw::c_char, ...);

-----

let pid = getpid();
    let is_roblox = util::is_roblox_process(pid);

    println!("is roblox: {}, pid: {}", is_roblox, pid);

    if !is_roblox {
        println!("not roblox, exiting");
        return;
    }

    println!("sleeping for 15 seconds");

    thread::sleep(Duration::from_secs(15));

    println!("sleeping done");

    let base = get_module_handle();
    println!("base is: {}", base);

    let print = aslr!(0x100bae55d);

    let roblox_print: RobloxPrint = std::mem::transmute(print);

    roblox_print(
        0,
        ffi::CStr::from_bytes_with_nul_unchecked(b"hello little boy\0").as_ptr(),
    );

    Initalize::init();

*/
