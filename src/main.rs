#[allow(deprecated)]
use libc::{_dyld_get_image_vmaddr_slide, getpid};

mod util;

extern crate small_ctor;

#[small_ctor::ctor]
#[no_mangle]
unsafe fn my_ctor() {
    let pid = getpid();
    let is_roblox = util::is_roblox_process(pid);

    println!("is roblox: {}, pid: {}", is_roblox, pid);
    if !is_roblox {
        println!("not roblox, exiting");
        return;
    }

    #[allow(deprecated)]
    let base = _dyld_get_image_vmaddr_slide(0) as u32;

    println!("base: {}", base)
}

fn main() {
    println!("MAIN LOL");
}

/*
// temp 0x0 since idk the addys
let addy = (0x0 - 0x0 + handle as usize);
let roblox_print: RobloxPrint = unsafe { std::mem::transmute(addy) };

roblox_print(
    RobloxPrintType::Message,
    std::ffi::CString::new("hello little boy").unwrap().as_ptr(),
);
type RobloxPrint = extern "C" fn(i32, *const std::os::raw::c_char, ...);

*/
