#![allow(dead_code)]

extern crate small_ctor;

enum RobloxPrintType {
    Message,
    Warning,
    Error,
    Info,
}

type RobloxPrint = extern "C" fn(RobloxPrintType, *const std::os::raw::c_char, ...);

#[small_ctor::ctor]
unsafe fn my_ctor() {
    let handle = libc::dlopen(std::ptr::null(), libc::RTLD_LAZY);

    if handle.is_null() {
        let error = unsafe { libc::dlerror() };
        panic!("chigga the image didnt work: {:?}", error);
    }

    // temp 0x0 since idk the addys
    let addy = (0x0 - 0x0 + handle as usize);
    let roblox_print: RobloxPrint = unsafe { std::mem::transmute(addy) };

    roblox_print(
        RobloxPrintType::Message,
        std::ffi::CString::new("hello little boy").unwrap().as_ptr(),
    );

    unsafe {
        libc::dlclose(handle);
    }
}

fn main() {
    println!("MAIN LOL");
}
