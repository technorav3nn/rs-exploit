#[allow(deprecated)]
use libc::_dyld_get_image_header;

type RPrint = extern "C" fn(arg1: i32, arg2: *const u8);

#[allow(deprecated)]
pub unsafe fn rbx_print(mode: i32, message: &str) {
    let aslr_slide = 0x100000000;
    let func_address: i64 = 0x100BAE55D;
    let header = _dyld_get_image_header(0) as i64;

    let func_ptr = (func_address - aslr_slide + header) as *const RPrint;

    println!(
        "func_ptr: {:p}, func address: {}, slide: {}",
        func_ptr, func_address, aslr_slide
    );

    (*func_ptr)(mode, message.as_bytes().as_ptr());
}
